<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metrics - Waverless</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        .time-controls { display: flex; gap: 12px; align-items: center; margin-bottom: 20px; }
        .time-btn { padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; background: #fff; font-size: 13px; cursor: pointer; }
        .time-btn.active { background: #1da1f2; color: #fff; border-color: #1da1f2; }
        .metrics-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 20px; }
        .metric-card { background: #fff; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .metric-header { display: flex; justify-content: space-between; align-items: center; padding: 14px 16px; border-bottom: 1px solid #f3f4f6; }
        .metric-title { font-size: 14px; font-weight: 600; color: #1f2937; }
        .metric-total { font-size: 12px; color: #6b7280; }
        .metric-total span { font-weight: 600; color: #1f2937; }
        .metric-legend { display: flex; gap: 16px; padding: 8px 16px; font-size: 12px; }
        .legend-item { display: flex; align-items: center; gap: 6px; }
        .legend-dot { width: 8px; height: 8px; border-radius: 50%; }
        .metric-chart { height: 220px; padding: 8px 16px 16px; }
        .full-width { grid-column: 1 / -1; }
        .section-title { font-size: 16px; font-weight: 600; color: #1f2937; margin: 24px 0 16px; padding-bottom: 8px; border-bottom: 1px solid #e5e7eb; }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo"><i class="fas fa-bolt"></i><span>Waverless</span></div>
        <nav class="nav-menu">
            <a href="index.html" class="nav-item"><i class="fas fa-th-large"></i><span>Dashboard</span></a>
            <a href="serverless.html" class="nav-item"><i class="fas fa-rocket"></i><span>Serverless</span></a>
            <a href="endpoints.html" class="nav-item"><i class="fas fa-server"></i><span>Endpoints</span></a>
            <a href="tasks.html" class="nav-item"><i class="fas fa-tasks"></i><span>Tasks</span></a>
            <a href="metrics.html" class="nav-item active"><i class="fas fa-chart-line"></i><span>Metrics</span></a>
        </nav>
    </div>

    <div class="main-content">
        <header class="header">
            <h1 class="page-title">Metrics</h1>
            <div class="user-info"><div class="user-avatar">A</div><span>Admin</span></div>
        </header>

        <div class="content">
            <!-- Time Controls -->
            <div class="time-controls">
                <span style="font-size:13px;color:#6b7280;">Time Range:</span>
                <button class="time-btn" onclick="setRange('1h')">1H</button>
                <button class="time-btn" onclick="setRange('6h')">6H</button>
                <button class="time-btn active" onclick="setRange('24h')">24H</button>
                <button class="time-btn" onclick="setRange('7d')">7D</button>
                <button class="time-btn" onclick="setRange('30d')">30D</button>
                <select class="filter-select" style="margin-left:auto;">
                    <option value="">All Endpoints</option>
                    <option value="flux">flux-schnell-prod</option>
                    <option value="wan21">wan21-inference</option>
                </select>
                <label style="display:flex;align-items:center;gap:6px;font-size:13px;color:#374151;cursor:pointer;">
                    <input type="checkbox" id="liveToggle"> <i class="fas fa-circle" style="color:#48bb78;font-size:8px;"></i> Live
                </label>
            </div>

            <!-- Summary Stats -->
            <div class="stats-grid" style="margin-bottom:20px;">
                <div class="stat-card">
                    <div class="stat-icon blue"><i class="fas fa-paper-plane"></i></div>
                    <div class="stat-content"><div class="stat-label">Total Requests</div><div class="stat-value">54,717</div></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green"><i class="fas fa-users"></i></div>
                    <div class="stat-content"><div class="stat-label">Active Workers</div><div class="stat-value">42</div></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon purple"><i class="fas fa-clock"></i></div>
                    <div class="stat-content"><div class="stat-label">Avg Execution</div><div class="stat-value">8.7s</div></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orange"><i class="fas fa-percentage"></i></div>
                    <div class="stat-content"><div class="stat-label">Success Rate</div><div class="stat-value">99.7%</div></div>
                </div>
            </div>

            <!-- Task Metrics -->
            <div class="section-title"><i class="fas fa-tasks" style="margin-right:8px;color:#1da1f2;"></i>Task Metrics</div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Requests</span>
                        <span class="metric-total">Total: <span>54,717</span></span>
                    </div>
                    <div class="metric-legend">
                        <div class="legend-item"><div class="legend-dot" style="background:#48bb78;"></div>Completed: <strong>54,678</strong></div>
                        <div class="legend-item"><div class="legend-dot" style="background:#f56565;"></div>Failed: <strong>39</strong></div>
                        <div class="legend-item"><div class="legend-dot" style="background:#ecc94b;"></div>Retried: <strong>11</strong></div>
                    </div>
                    <div class="metric-chart" id="requestsChart"></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Execution Time</span>
                        <span class="metric-total">Avg: <span>8.7s</span> P95: <span>15.2s</span></span>
                    </div>
                    <div class="metric-chart" id="execTimeChart"></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Queue Wait Time</span>
                        <span class="metric-total">Avg: <span>250ms</span></span>
                    </div>
                    <div class="metric-chart" id="queueWaitChart"></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Execution Time Distribution</span>
                    </div>
                    <div class="metric-chart" id="execDistChart"></div>
                </div>
            </div>

            <!-- Worker Metrics -->
            <div class="section-title"><i class="fas fa-server" style="margin-right:8px;color:#8b5cf6;"></i>Worker Metrics</div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Worker Count</span>
                        <span class="metric-total">Avg: <span>8.5</span></span>
                    </div>
                    <div class="metric-legend">
                        <div class="legend-item"><div class="legend-dot" style="background:#1da1f2;"></div>Active</div>
                        <div class="legend-item"><div class="legend-dot" style="background:#94a3b8;"></div>Idle</div>
                    </div>
                    <div class="metric-chart" id="workerCountChart"></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Worker Utilization</span>
                        <span class="metric-total">Avg: <span>76.3%</span></span>
                    </div>
                    <div class="metric-chart" id="workerUtilChart"></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Worker Idle Time (Avg)</span>
                        <span class="metric-total">Total: <span>12.5h</span></span>
                    </div>
                    <div class="metric-chart" id="idleTimeChart"></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Worker Lifecycle Events</span>
                        <span class="metric-total">Created: <span>45</span> Terminated: <span>38</span></span>
                    </div>
                    <div class="metric-legend">
                        <div class="legend-item"><div class="legend-dot" style="background:#48bb78;"></div>Created</div>
                        <div class="legend-item"><div class="legend-dot" style="background:#f56565;"></div>Terminated</div>
                    </div>
                    <div class="metric-chart" id="lifecycleChart"></div>
                </div>
            </div>

            <!-- Resource Metrics -->
            <div class="section-title"><i class="fas fa-microchip" style="margin-right:8px;color:#f59e0b;"></i>Resource Metrics</div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">GPU Utilization</span>
                        <span class="metric-total">Avg: <span>82.4%</span></span>
                    </div>
                    <div class="metric-legend">
                        <div class="legend-item"><div class="legend-dot" style="background:#8b5cf6;"></div>Average</div>
                        <div class="legend-item"><div class="legend-dot" style="background:#f59e0b;"></div>Peak</div>
                    </div>
                    <div class="metric-chart" id="gpuUtilChart"></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">CPU Utilization</span>
                        <span class="metric-total">Avg: <span>45.2%</span></span>
                    </div>
                    <div class="metric-chart" id="cpuUtilChart"></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Memory Usage</span>
                        <span class="metric-total">Avg: <span>68.5%</span></span>
                    </div>
                    <div class="metric-chart" id="memoryChart"></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Cold Start Time</span>
                        <span class="metric-total">Avg: <span>2.5min</span> Count: <span>45</span></span>
                    </div>
                    <div class="metric-chart" id="coldStartChart"></div>
                </div>
            </div>

            <!-- Webhook Metrics -->
            <div class="section-title"><i class="fas fa-link" style="margin-right:8px;color:#48bb78;"></i>Webhook Metrics</div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Webhook Responses</span>
                        <span class="metric-total">Total: <span>54,732</span></span>
                    </div>
                    <div class="metric-legend">
                        <div class="legend-item"><div class="legend-dot" style="background:#48bb78;"></div>2xx: <strong>54,715</strong></div>
                        <div class="legend-item"><div class="legend-dot" style="background:#a0aec0;"></div>0xx: <strong>17</strong></div>
                    </div>
                    <div class="metric-chart" id="webhookChart"></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Queue Length</span>
                        <span class="metric-total">Max: <span>156</span></span>
                    </div>
                    <div class="metric-chart" id="queueLengthChart"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const hours = Array.from({length:24}, (_,i) => `${i}:00`);
        const charts = {};

        function initCharts() {
            // Requests Chart
            charts.requests = echarts.init(document.getElementById('requestsChart'));
            charts.requests.setOption({
                grid: { left: 40, right: 16, top: 10, bottom: 24 },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: hours, axisLabel: { fontSize: 10, color: '#6b7280' } },
                yAxis: { type: 'value', axisLabel: { fontSize: 10, color: '#6b7280' } },
                series: [
                    { name: 'Completed', type: 'bar', stack: 'a', data: Array.from({length:24}, () => 2000+Math.random()*500), itemStyle: { color: '#48bb78' }, barMaxWidth: 12 },
                    { name: 'Failed', type: 'bar', stack: 'a', data: Array.from({length:24}, () => Math.random()*5), itemStyle: { color: '#f56565' } }
                ]
            });

            // Execution Time Chart
            charts.execTime = echarts.init(document.getElementById('execTimeChart'));
            charts.execTime.setOption({
                grid: { left: 40, right: 16, top: 10, bottom: 24 },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: hours, axisLabel: { fontSize: 10, color: '#6b7280' } },
                yAxis: { type: 'value', axisLabel: { fontSize: 10, color: '#6b7280', formatter: '{value}s' } },
                series: [
                    { name: 'P95', type: 'line', data: Array.from({length:24}, () => 12+Math.random()*6), smooth: true, symbol: 'none', lineStyle: { color: '#f56565' }, areaStyle: { color: 'rgba(245,101,101,0.1)' } },
                    { name: 'P50', type: 'line', data: Array.from({length:24}, () => 7+Math.random()*3), smooth: true, symbol: 'none', lineStyle: { color: '#1da1f2' }, areaStyle: { color: 'rgba(29,161,242,0.1)' } }
                ]
            });

            // Queue Wait Chart
            charts.queueWait = echarts.init(document.getElementById('queueWaitChart'));
            charts.queueWait.setOption({
                grid: { left: 40, right: 16, top: 10, bottom: 24 },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: hours, axisLabel: { fontSize: 10, color: '#6b7280' } },
                yAxis: { type: 'value', axisLabel: { fontSize: 10, color: '#6b7280', formatter: '{value}ms' } },
                series: [{ type: 'bar', data: Array.from({length:24}, () => 100+Math.random()*400), itemStyle: { color: '#f59e0b' }, barMaxWidth: 10 }]
            });

            // Execution Distribution Chart
            charts.execDist = echarts.init(document.getElementById('execDistChart'));
            charts.execDist.setOption({
                grid: { left: 50, right: 16, top: 10, bottom: 24 },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: ['0-1s','1-2s','2-3s','3-5s','5-10s','10s+'], axisLabel: { fontSize: 10, color: '#6b7280' } },
                yAxis: { type: 'value', axisLabel: { fontSize: 10, color: '#6b7280' } },
                series: [{ type: 'bar', data: [1200, 8500, 12000, 18000, 10000, 5000], itemStyle: { color: '#8b5cf6' }, barMaxWidth: 30 }]
            });

            // Worker Count Chart
            charts.workerCount = echarts.init(document.getElementById('workerCountChart'));
            charts.workerCount.setOption({
                grid: { left: 40, right: 16, top: 10, bottom: 24 },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: hours, axisLabel: { fontSize: 10, color: '#6b7280' } },
                yAxis: { type: 'value', axisLabel: { fontSize: 10, color: '#6b7280' } },
                series: [
                    { name: 'Active', type: 'line', stack: 'a', data: Array.from({length:24}, () => 5+Math.random()*4), smooth: true, symbol: 'none', areaStyle: { color: '#1da1f2' } },
                    { name: 'Idle', type: 'line', stack: 'a', data: Array.from({length:24}, () => 1+Math.random()*3), smooth: true, symbol: 'none', areaStyle: { color: '#94a3b8' } }
                ]
            });

            // Worker Utilization Chart
            charts.workerUtil = echarts.init(document.getElementById('workerUtilChart'));
            charts.workerUtil.setOption({
                grid: { left: 40, right: 16, top: 10, bottom: 24 },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: hours, axisLabel: { fontSize: 10, color: '#6b7280' } },
                yAxis: { type: 'value', max: 100, axisLabel: { fontSize: 10, color: '#6b7280', formatter: '{value}%' } },
                series: [{ type: 'line', data: Array.from({length:24}, () => 60+Math.random()*30), smooth: true, symbol: 'none', lineStyle: { color: '#10b981' }, areaStyle: { color: 'rgba(16,185,129,0.1)' } }]
            });

            // Idle Time Chart
            charts.idleTime = echarts.init(document.getElementById('idleTimeChart'));
            charts.idleTime.setOption({
                grid: { left: 40, right: 16, top: 10, bottom: 24 },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: hours, axisLabel: { fontSize: 10, color: '#6b7280' } },
                yAxis: { type: 'value', axisLabel: { fontSize: 10, color: '#6b7280', formatter: '{value}m' } },
                series: [{ type: 'bar', data: Array.from({length:24}, () => 1+Math.random()*5), itemStyle: { color: '#f59e0b' }, barMaxWidth: 10 }]
            });

            // Lifecycle Chart
            charts.lifecycle = echarts.init(document.getElementById('lifecycleChart'));
            charts.lifecycle.setOption({
                grid: { left: 40, right: 16, top: 10, bottom: 24 },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: hours, axisLabel: { fontSize: 10, color: '#6b7280' } },
                yAxis: { type: 'value', axisLabel: { fontSize: 10, color: '#6b7280' } },
                series: [
                    { name: 'Created', type: 'bar', data: Array.from({length:24}, () => Math.floor(Math.random()*4)), itemStyle: { color: '#48bb78' }, barMaxWidth: 10 },
                    { name: 'Terminated', type: 'bar', data: Array.from({length:24}, () => Math.floor(Math.random()*3)), itemStyle: { color: '#f56565' } }
                ]
            });

            // GPU Utilization Chart
            charts.gpuUtil = echarts.init(document.getElementById('gpuUtilChart'));
            charts.gpuUtil.setOption({
                grid: { left: 40, right: 16, top: 10, bottom: 24 },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: hours, axisLabel: { fontSize: 10, color: '#6b7280' } },
                yAxis: { type: 'value', max: 100, axisLabel: { fontSize: 10, color: '#6b7280', formatter: '{value}%' } },
                series: [
                    { name: 'Avg', type: 'line', data: Array.from({length:24}, () => 70+Math.random()*20), smooth: true, symbol: 'none', lineStyle: { color: '#8b5cf6' }, areaStyle: { color: 'rgba(139,92,246,0.1)' } },
                    { name: 'Peak', type: 'line', data: Array.from({length:24}, () => 85+Math.random()*12), smooth: true, symbol: 'none', lineStyle: { color: '#f59e0b', type: 'dashed' } }
                ]
            });

            // CPU Utilization Chart
            charts.cpuUtil = echarts.init(document.getElementById('cpuUtilChart'));
            charts.cpuUtil.setOption({
                grid: { left: 40, right: 16, top: 10, bottom: 24 },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: hours, axisLabel: { fontSize: 10, color: '#6b7280' } },
                yAxis: { type: 'value', max: 100, axisLabel: { fontSize: 10, color: '#6b7280', formatter: '{value}%' } },
                series: [{ type: 'line', data: Array.from({length:24}, () => 30+Math.random()*30), smooth: true, symbol: 'none', lineStyle: { color: '#3b82f6' }, areaStyle: { color: 'rgba(59,130,246,0.1)' } }]
            });

            // Memory Chart
            charts.memory = echarts.init(document.getElementById('memoryChart'));
            charts.memory.setOption({
                grid: { left: 40, right: 16, top: 10, bottom: 24 },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: hours, axisLabel: { fontSize: 10, color: '#6b7280' } },
                yAxis: { type: 'value', max: 100, axisLabel: { fontSize: 10, color: '#6b7280', formatter: '{value}%' } },
                series: [{ type: 'line', data: Array.from({length:24}, () => 55+Math.random()*25), smooth: true, symbol: 'none', lineStyle: { color: '#06b6d4' }, areaStyle: { color: 'rgba(6,182,212,0.1)' } }]
            });

            // Cold Start Chart
            charts.coldStart = echarts.init(document.getElementById('coldStartChart'));
            charts.coldStart.setOption({
                grid: { left: 40, right: 16, top: 10, bottom: 24 },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: hours, axisLabel: { fontSize: 10, color: '#6b7280' } },
                yAxis: { type: 'value', axisLabel: { fontSize: 10, color: '#6b7280', formatter: '{value}s' } },
                series: [{ type: 'bar', data: Array.from({length:24}, () => 100+Math.random()*80), itemStyle: { color: '#ec4899' }, barMaxWidth: 10 }]
            });

            // Webhook Chart
            charts.webhook = echarts.init(document.getElementById('webhookChart'));
            charts.webhook.setOption({
                grid: { left: 40, right: 16, top: 10, bottom: 24 },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: hours, axisLabel: { fontSize: 10, color: '#6b7280' } },
                yAxis: { type: 'value', axisLabel: { fontSize: 10, color: '#6b7280' } },
                series: [
                    { name: '2xx', type: 'bar', stack: 'a', data: Array.from({length:24}, () => 2000+Math.random()*500), itemStyle: { color: '#48bb78' }, barMaxWidth: 12 },
                    { name: '0xx', type: 'bar', stack: 'a', data: Array.from({length:24}, () => Math.random()*3), itemStyle: { color: '#a0aec0' } }
                ]
            });

            // Queue Length Chart
            charts.queueLength = echarts.init(document.getElementById('queueLengthChart'));
            charts.queueLength.setOption({
                grid: { left: 40, right: 16, top: 10, bottom: 24 },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: hours, axisLabel: { fontSize: 10, color: '#6b7280' } },
                yAxis: { type: 'value', axisLabel: { fontSize: 10, color: '#6b7280' } },
                series: [{ type: 'line', data: Array.from({length:24}, () => 10+Math.random()*50), smooth: true, symbol: 'none', lineStyle: { color: '#f56565' }, areaStyle: { color: 'rgba(245,101,101,0.1)' } }]
            });
        }

        function setRange(range) {
            document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            // Refresh charts with new range
        }

        window.addEventListener('resize', () => {
            Object.values(charts).forEach(c => c.resize());
        });

        initCharts();
    </script>
</body>
</html>
