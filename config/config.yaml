server:
  port: 8080
  mode: debug  # debug or release
  api_key: test
  base_url: http://localhost:8080

redis:
  addr: 127.0.0.1:6379
  password: ""
  db: 2


mysql:
  host: 127.0.0.1
  port: 63938
  user: wavespeed
  password: wavespeed&123!
  database: waverless
  # Optional: Proxy configuration (uncomment to enable)
  # proxy:
  #   enabled: true
  #   type: socks5      # http, https, or socks5
  #   host: 127.0.0.1
  #   port: 7890
queue:
  concurrency: 10
  max_retry: 3
  task_timeout: 3600      # Task execution timeout (seconds) - global default, can be overridden per endpoint
  task_retention: 86400   # Task data retention time (seconds)

worker:
  heartbeat_interval: 10   # Worker heartbeat interval (seconds)
  heartbeat_timeout: 60    # Worker heartbeat timeout (seconds) - also used as cleanup interval
  default_concurrency: 1   # Default worker concurrency

# Task Recovery Mechanism:
# 1. Worker Offline Recovery (Primary): When a worker misses heartbeat for 60s,
#    all its in-progress tasks are automatically re-enqueued
# 2. Task Timeout (Fallback): Tasks running longer than task_timeout (default 3600s)
#    will be failed (future enhancement)
# 3. Per-Endpoint Timeout: Each endpoint can specify its own task_timeout in metadata

logger:
  level: info             # Log level: debug, info, warn, error
  output: both          # Output mode: console, file, both
  file:
    path: /tmp/log/waverless/app.log

k8s:
  enabled: true                  # Enable K8s functionality
  namespace: wavespeed-test           # K8s namespace
  platform: aliyun-ack           # Platform type: generic, aliyun-ack, aws-eks
  config_dir: ./config           # Configuration directory (contains specs.yaml and templates/)
  # global_env: {}               # Optional: override default environment variables

autoscaler:
  enabled: true                 # Enable autoscaling
  interval: 10                   # Control loop interval (seconds)
  max_gpu_count: 3               # Total cluster GPU count
  max_cpu_cores: 1000000             # Total cluster CPU cores
  max_memory_gb: 1000000             # Total cluster memory (GB)
  starvation_time: 300           # Starvation time threshold (seconds), temporarily elevate priority if resources are not allocated after this time

# Storage providers configuration
providers:
  deployment: k8s            # Deployment provider: k8s, docker, novita
  metadata: mysql               # Metadata storage: mysql (persistent), redis (ephemeral)
  # MySQL stores: endpoints, tasks, autoscaler configs, scaling events
  # Redis stores: worker heartbeats, task queues, distributed locks, cache

# Novita Serverless Configuration
novita:
  enabled: false  # Enable Novita serverless provider
  api_key: ""     # Your Novita API key (Bearer token)
  base_url: "https://api.novita.ai"  # Novita API base URL
  config_dir: "./config"  # Configuration directory (contains specs.yaml and templates/)
  poll_interval: 10  # Poll interval for status updates (seconds, default: 10)

# Image Validation Configuration
# Validates image format and existence before creating endpoints
imageValidation:
  enabled: true              # Enable image validation (default: true)
  timeout: 30s               # Timeout for validation requests (default: 30s)
  cacheDuration: 1h          # How long to cache validation results (default: 1h)
  skipOnTimeout: true        # Proceed with warning when validation times out (default: true)

# Resource Releaser Configuration
# Automatically releases resources when image pull fails
resourceReleaser:
  imagePullTimeout: 5m       # Max time to wait for image pull (default: 5m)
  checkInterval: 30s         # Interval between checks for stuck workers (default: 30s)
  maxRetries: 3              # Max termination retries (default: 3)
